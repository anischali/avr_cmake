#include "font.h"
#include "common.h"
#include <stdarg.h>
#include <stdio.h>
#include <string.h>

static char buffer[128];


const uint8_t xconst ascii_8x5_font[][5] = {
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x03, 0x43, 0x53, 0xab, 0x54},
    {0x0},
};


void write_font(struct screen_t *screen, struct font_t *font, struct point_t *offset, const char *fmt, ...) {
    va_list args;
    char *c;
    struct point_t pos = { offset->x, offset->y };

    va_start(args, fmt);
    int size = sizeof(buffer);
    memset(buffer, 0x0, size);
    size = vsnprintf(buffer, size, fmt, args);

    if (!font || !font->ops || !font->ops->fill_pixels)
        return;

    c = buffer;

    do {
        font->ops->fill_pixels(screen, font, &pos, *c);
    } while (c++);
}




void ascii_8x5_fill_pixels(struct screen_t *screen, struct font_t *font, struct point_t *offset, const char c) {
    
    uint8_t *glyph = font->pixels[(int)c];
    static struct ebitmap_t glyph_bmp = { .width = 8, .height = 5, .bits_per_pixel = 1};

    switch(c) {
        case '\n':
            offset->y += font->pix_height + 1;
            break;
        case '\r':
            offset->x = 0;
            break;
        default:
            glyph_bmp.pixels = glyph;
            screen_draw_bitmap(screen, &glyph_bmp, offset);
            offset->x += glyph_bmp.width + 1;
    }

}

